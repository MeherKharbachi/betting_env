[
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "betting_env",
    "section": "",
    "text": "from IPython.display import HTML\nimport pandas as pd\n\nfrom betting_env.config.localconfig import CONFIG,DB_HOSTS\nfrom betting_env.utils.data_extractor import data_aggregator\nfrom betting_env.betting_env import BettingEnv"
  },
  {
    "objectID": "index.html#install",
    "href": "index.html#install",
    "title": "betting_env",
    "section": "Install",
    "text": "Install\npip install betting_env"
  },
  {
    "objectID": "index.html#simplified-betting-environment",
    "href": "index.html#simplified-betting-environment",
    "title": "betting_env",
    "section": "Simplified betting environment",
    "text": "Simplified betting environment\nThe punter starts with $N (N>0) in his Bank account and can use them to place bets on several football games.\nHe is offered the option to bet on the 2 main markets: 1X2 (home/draw/away) and Asian handicap (we focus on the even line) and is only allowed to place a small, medium, or big stake on one and only one of the 5 possible selections home team win, away team win, or draw (1X2 case) or home or away (Asian handicap) or skip the betting opportunity. At each step, the punter is presented with some information about a game and the associated betting opportunities. If he decides to bet, he receives a reward that could be positive (profit) or negative (loss of his stake). His balance is then updated accordingly and he moves to the next step i.e next game. An episode ends when the punter goes bankrupt (Balance <= 0) or if no more betting opportunities are available.\n\nLoad games\n\nfixtures = data_aggregator(\n    db_hosts=DB_HOSTS, config=CONFIG, db_host=\"public_atlas\", limit=None\n)\n\n\n\nInit environment\n\nenv = BettingEnv(fixtures)\nmax_steps_limit = fixtures.shape[0]\n\n\n\nPlaying random choices\n\n# Init RL env.\nenv.reset()\n\n# Init done Flag to False.\ndone = False\n# Init loop counter.\ni = 0\n# Stops when it is done or when we have bet on all provided games.\nwhile not done and i < max_steps_limit:\n    # Make a step.\n    obs, reward, done, info = env.step(env.action_space.sample())\n    # Increment counter.\n    i = i + 1\n\nHTML('<img src=\"./images/img_1.gif\">')\n\n\n\n\n\n\nPlaying Medium Stake on Home Team Win (1X2)\n\n# Init RL env.\nenv.reset()\n# Init done Flag to False.\ndone = False\n# Init loop counter.\ni = 0\n# Stops when it is done or when we have bet on all provided games.\nwhile not done and i < max_steps_limit:\n    # Make a step.\n    obs, reward, done, info = env.step(2)\n    # Increment counter.\n    i = i + 1\n\nHTML('<img src=\"./images/img_2.gif\">')"
  },
  {
    "objectID": "Config/config.html",
    "href": "Config/config.html",
    "title": "Config",
    "section": "",
    "text": "from IPython.core.debugger import set_trace\n\n\nLoad Config\nThe config file for this project is defined in toml format and should be loaded at the start of this project. It is saved by default under the package root under config.toml. It is the user’s responsibility to make sure this file is saved at the right location."
  },
  {
    "objectID": "Config/mongo.html",
    "href": "Config/mongo.html",
    "title": "Mongo",
    "section": "",
    "text": "from IPython.core.debugger import set_trace\n\n\nsource\n\ndb_connect\n\n db_connect (db_hosts:Dict, config:Dict, db_host:str, db_name:str,\n             db_alias:Optional[str]=None)\n\nConnect to the apprpriate mongo database.\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ndb_hosts\ntyping.Dict\n\nAll DB hosts.\n\n\nconfig\ntyping.Dict\n\nDatabase config.\n\n\ndb_host\nstr\n\nHost name as defined in DB_HOSTS.\n\n\ndb_name\nstr\n\nName of the database to connect to.\n\n\ndb_alias\ntyping.Optional[str]\nNone\n\n\n\n\nHere we register the connection to the database where the Fixtures info are saved. It will be used later to extract the game information needed to our RL environment.\n\ndb_connect(\n    db_hosts=DB_HOSTS,\n    config=CONFIG,\n    db_host=\"public_atlas\",\n    db_name=CONFIG[\"connections\"][\"features\"][\"db\"],\n    db_alias=\"features\",\n)\n\nWe will need a function to set-up all the mongoDB connections. It should be called when the package is initialised:\n\nsource\n\n\nmongo_init\n\n mongo_init (db_host:str, db_hosts:Dict={'public_atlas'},\n             config:Dict={'title': 'Python Config', 'databases':\n             {'public_atlas': {'password': 'DgYu5U9OhRATmkQ7', 'port': '',\n             'url': 'cluster0.ierf2gk.mongodb.net', 'user': 'user',\n             'authSource': 'admin', 'connection_delay': '', 'mongo_base':\n             'mongodb+srv://', 'retry_writes': True, 'majority': True}},\n             'connections': {'features': {'db': 'Features', 'lineups':\n             'lineups', 'game_features': 'gameFeatures_test', 'odds':\n             'odds'}}})\n\nRegister all the required mongo connections.\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ndb_host\nstr\n\nHost name as defined in DB_HOSTS.\n\n\ndb_hosts\ntyping.Dict\n{‘public_atlas’}\nAll DB hosts.\n\n\nconfig\ntyping.Dict\n{‘title’: ‘Python Config’, ‘databases’: {‘public_atlas’: {‘password’: ‘DgYu5U9OhRATmkQ7’, ‘port’: ’‘, ’url’: ‘cluster0.ierf2gk.mongodb.net’, ‘user’: ‘user’, ‘authSource’: ‘admin’, ‘connection_delay’: ’‘, ’mongo_base’: ‘mongodb+srv://’, ‘retry_writes’: True, ‘majority’: True}}, ‘connections’: {‘features’: {‘db’: ‘Features’, ‘lineups’: ‘lineups’, ‘game_features’: ‘gameFeatures_test’, ‘odds’: ‘odds’}}}\nDatabase config.\n\n\n\n\nmongo_init(\"public_atlas\")"
  },
  {
    "objectID": "dataStrcuture/game_features.html",
    "href": "dataStrcuture/game_features.html",
    "title": "Games Features",
    "section": "",
    "text": "These features are computed at the game level and contains: + metadata: general information about game date, team identity, competition, … + stadium information: coordinates, ssurface, capacity, … + condition day time, attendane, meteo, … + dominace: The head to head record between the home and away team\nThe document also contains tagret information i.e, the different prediction targets such as the match-outcome, score, goal-difference,… They are identified with the tgt_ prefix.\n\nsource\n\n\n\n GameFeatures (*args, **values)\n\nStore the game-features for a given game identified by its id\n\nfrom betting_env.config.mongo import mongo_init\nfrom betting_env.config.localconfig import CONFIG, DB_HOSTS\n\n\n# Initialise connections.\nmongo_init(db_hosts=DB_HOSTS, config=CONFIG, db_host=\"public_atlas\")\n\n# Get all fixtures.\nfixtures = GameFeatures.get_all_games()\n\n# Fixtures.\n\nfixtures = pd.DataFrame(fixtures.as_pymongo())\nfixtures.head()\n\n\n\n\n\n  \n    \n      \n      _id\n      gameId\n      game_optaId\n      gameDate\n      seasonId\n      competitionId\n      homeTeamId\n      homeTeam_optaId\n      awayTeamId\n      awayTeam_optaId\n      ...\n      homeTeamDominance\n      awayTeamDominance\n      tgt_half_gd\n      tgt_gd\n      tgt_homeTeamGoals\n      tgt_awayTeamGoals\n      tgt_half_homeTeamGoals\n      tgt_half_awayTeamGoals\n      tgt_outcome\n      tgt_half_outcome\n    \n  \n  \n    \n      0\n      63ff6730078c55548211e113\n      174dba7291174b4dbbfa9ea12dd944bb45bdd8ed905524...\n      990997\n      2018-08-22 18:45:00\n      2018\n      2938f6103c8ba81a5c9a2822113eab2b2bcd4f175d655f...\n      126905d14981e6b97912ad4fec354035ccef26cb8ec4e1...\n      7\n      419088133137a53bfdb1b7e2e682d223d33a6fa075bbfe...\n      94\n      ...\n      0.166667\n      0.666667\n      0\n      0\n      2\n      2\n      1\n      1\n      0.5\n      0.5\n    \n    \n      1\n      63ff6730078c55548211e114\n      219ef70c0e8a803ec1efdb793443edfaa32398690c7829...\n      991003\n      2018-08-22 18:45:00\n      2018\n      2938f6103c8ba81a5c9a2822113eab2b2bcd4f175d655f...\n      aeb2f56fcedbcf4cd5c780179766996c7bf0b308064541...\n      5\n      f8daf96ad35eebf1c0a5886c72734ba7dec366d6637052...\n      108\n      ...\n      0.250000\n      0.750000\n      -2\n      0\n      2\n      2\n      0\n      2\n      0.5\n      0.0\n    \n    \n      2\n      63ff6730078c55548211e115\n      0655e244d8d596b5572e86426e2a7ca6178044efa59437...\n      991013\n      2018-08-25 14:00:00\n      2018\n      2938f6103c8ba81a5c9a2822113eab2b2bcd4f175d655f...\n      9ee012a80cade2df55b71580bf5e238bcd6be6f696fdc1...\n      45\n      38ca605bcd29a5a37697ca66e533ae817ced71b6bf275c...\n      2\n      ...\n      0.333333\n      0.583333\n      -2\n      -3\n      0\n      3\n      0\n      2\n      0.0\n      0.0\n    \n    \n      3\n      63ff6730078c55548211e116\n      019c223b4a03917c2f1685beab4d5d278f7bff3913f239...\n      991018\n      2018-08-25 14:00:00\n      2018\n      2938f6103c8ba81a5c9a2822113eab2b2bcd4f175d655f...\n      eb89c068ca204a72408360450847a990c97c5b5ff0ec9f...\n      110\n      bbb63e4ea54b0d60b48a1f8440254d7e656dfbfcbef825...\n      88\n      ...\n      0.555556\n      0.222222\n      1\n      2\n      2\n      0\n      1\n      0\n      1.0\n      1.0\n    \n    \n      4\n      63ff6730078c55548211e117\n      0f9ad12eec9f24277ab491f5f26f610eaa918903a34147...\n      991014\n      2018-08-25 16:30:00\n      2018\n      2938f6103c8ba81a5c9a2822113eab2b2bcd4f175d655f...\n      04c71986b6503ba5b09a7098ceb79954d20049f21ba45b...\n      17\n      95d3bddc19a15d34a7876dcffc1a3e9bc63d809b69308a...\n      41\n      ...\n      0.611111\n      0.277778\n      -1\n      0\n      2\n      2\n      0\n      1\n      0.5\n      0.0\n    \n  \n\n5 rows × 30 columns"
  },
  {
    "objectID": "dataStrcuture/team_lineup.html",
    "href": "dataStrcuture/team_lineup.html",
    "title": "Teams Lineups",
    "section": "",
    "text": "The Player class contains the necassary information about the player reported on the team-sheet. If the player is starting the game, a more detailed class StartingPlayer will store further information about his position on the pitch and the formation the team is playing.\n\nsource\n\n\n\n StartingPlayer (*args, **kwargs)\n\nExtends the Player class with extra information about a Player starting the game\n\nsource\n\n\n\n\n Player (*args, **kwargs)\n\nStores main information about a player reported on the team sheet"
  },
  {
    "objectID": "dataStrcuture/team_lineup.html#the-lineup-document",
    "href": "dataStrcuture/team_lineup.html#the-lineup-document",
    "title": "Teams Lineups",
    "section": "The LineUp Document",
    "text": "The LineUp Document\nThe TeamSheet Class directly inherits from mongoengine.Document and contains a couple of embedded documents: * Starting is a a mongoengine.EmbeddedDocumentListField storing information about the players starting the game. * Bench is also a mongoengine.EmbeddedDocumentListField storing information about the players on the bech. * All these document all populated by Player objects.\n\nsource\n\nTeamSheet\n\n TeamSheet (*args, **values)\n\nStore the team-sheet information for a given game.\n\nfrom betting_env.config.mongo import mongo_init\nfrom betting_env.config.localconfig import CONFIG, DB_HOSTS\n\n\n# Initialise connections.\nmongo_init(db_hosts=DB_HOSTS, config=CONFIG, db_host=\"public_atlas\")\n\naston_villa_id = \"126905d14981e6b97912ad4fec354035ccef26cb8ec4e1cb20573c7b583b1c70\"\n\nlineup = TeamSheet.get_latest(\n    ra_team_id=aston_villa_id, date=datetime.datetime(2018, 8, 22, 19, 15, 0)\n)\n{x.name: x.position for x in lineup.starting}\n\n{'Glenn Whelan': 'DMR',\n 'Mile Jedinak': 'DCL',\n 'John McGinn': 'DML',\n 'Jonathan Kodjia': 'FW',\n 'Albert Adomah': 'ML',\n 'Ahmed Elmohamady': 'MR',\n 'James Chester': 'DCR',\n 'Axel Tuanzebe': 'DR',\n 'Alan Hutton': 'DL',\n 'Orjan Nyland': 'GK',\n 'Jack Grealish': 'AMC'}"
  },
  {
    "objectID": "dataStrcuture/odds.html",
    "href": "dataStrcuture/odds.html",
    "title": "Odds",
    "section": "",
    "text": "In this document we will define a data structure for Odds and We are mainly interested by 3 types of markets:\n\n1x2\nasian-handicap\nover/under\n\n\nsource\n\n\n\n MarketOdds (*args, **values)\n\nStore the odds values\n\nfrom betting_env.config.mongo import mongo_init\nfrom betting_env.config.localconfig import CONFIG, DB_HOSTS\n\n\n# Initialise connections.\nmongo_init(db_hosts=DB_HOSTS, config=CONFIG, db_host=\"public_atlas\")\n\nra_game_id = \"174dba7291174b4dbbfa9ea12dd944bb45bdd8ed9055247ce85b0469dfcfb24e\"\nmarket = \"1x2\"\n\nodds_feats = MarketOdds.get_odds_features(\n    ra_game_id, market, date=datetime.datetime(2018, 8, 22, 18, 45, 0)\n)\nodds_feats\n\n\n\n\n\n  \n    \n      \n      id\n      game_id\n      game_opta_id\n      game_date\n      competition_id\n      competition_opta_id\n      season_id\n      home_team_id\n      away_team_id\n      bookmaker_id\n      ...\n      market_type\n      line_id\n      received_at\n      odds1\n      odds2\n      oddsX\n      overround\n      proba1\n      proba2\n      probaX\n    \n  \n  \n    \n      0\n      63ffd7e3ea1a2de013810547\n      174dba7291174b4dbbfa9ea12dd944bb45bdd8ed905524...\n      990997\n      2018-08-22 18:45:00\n      2938f6103c8ba81a5c9a2822113eab2b2bcd4f175d655f...\n      10\n      2018\n      126905d14981e6b97912ad4fec354035ccef26cb8ec4e1...\n      419088133137a53bfdb1b7e2e682d223d33a6fa075bbfe...\n      83\n      ...\n      1x2\n      None\n      2018-08-22 18:44:45.957\n      2.62\n      2.77\n      3.53\n      0.025976\n      0.372016\n      0.351871\n      0.276114\n    \n  \n\n1 rows × 22 columns"
  },
  {
    "objectID": "Utils/pnl_calculator.html",
    "href": "Utils/pnl_calculator.html",
    "title": "1X2 and Asian Handicap Profit",
    "section": "",
    "text": "Using the config.toml credentials included in the main repository, we must first load games data stored in our MongoDb Cluster before testing our betting environment."
  },
  {
    "objectID": "Utils/pnl_calculator.html#popular-betting-markets",
    "href": "Utils/pnl_calculator.html#popular-betting-markets",
    "title": "1X2 and Asian Handicap Profit",
    "section": "Popular betting markets",
    "text": "Popular betting markets\nThere are many types of bets available in football today but betting on the match outcome, known as the 1x2 market, is the most popular one by far. The punter can bet the 3 possible match outcomes: Home-win, draw or away-win.\nA second popular market, in particular in Asia, is known as Asian handicap and is directly linked to the game goal difference. It offers only 2 betting options known as home (1) or away (2) and assumes that one of the team will start with a handicap (known as the line) and the other with an advantage. There are 3 types of Asian handicap markets:\n\nInteger Lines: if the handicap chosen is equal to the score difference, it can result in a bet being returned.\nHalf Lines: the outcome of the wager is either a win or a loss.\nQuarter Lines: Divide your wager equally between the two AH lines above and beyond. For instance, a handicap of -0.75 is really two handicaps for the price of one, with half of your bet being made at -0.5 and the other half at -1, both of which are given the same odds. In this case, we have a win, half-win, half-loss, or a loss."
  },
  {
    "objectID": "Utils/pnl_calculator.html#pnl-computation",
    "href": "Utils/pnl_calculator.html#pnl-computation",
    "title": "1X2 and Asian Handicap Profit",
    "section": "PnL computation",
    "text": "PnL computation\n\n1X2 market\nThe PnL of the 1x2 market depends on the match outcome (home-win/draw/away-win) and is binary: the punter can either make a profit and get his stake returned or loose his stake.\n\\[ profit_{1X2} =  Stake *(Odds \\times -1)\\] With:\n\nStake : Invested money\nOdds : 1X2 European/decimal betting odds (> 1)\n\n\nsource\n\n\npnl_1X2\n\n pnl_1X2 (selection:numpy.ndarray, outcome:numpy.ndarray,\n          odds:numpy.ndarray)\n\nReturns the 1X2 PnL.\n\n\n\n\nType\nDetails\n\n\n\n\nselection\nndarray\nThe amount invested on each selection.\n\n\noutcome\nndarray\nGame result (Binary side outcome), shape=(1,5).\n\n\nodds\nndarray\nodds for the current game, shape=(1,5)\n\n\nReturns\nndarray\n1X2 PnL\n\n\n\n\n# Bet action (here, our action is betting 20% of our balance on away team).\nselection = (\n    np.array([[0, 0, 0.2, 0, 0], [0, 0.7, 0, 0, 0], [0.8, 0, 0.0, 0, 0]]) * 100.0\n)\n\ninfo = fixture.head(3)\n\n# Game odds.\nodds = info[\n    [\n        \"preGameOdds1\",\n        \"preGameOddsX\",\n        \"preGameOdds2\",\n        \"preGameAhHome\",\n        \"preGameAhAway\",\n    ]\n].values\n\n# Game result index(homewin -> 0 , draw -> 1, awaywin -> 2).\ngame_result = info[\"tgt_outcome\"].values.astype(int)\nbinary_result = np.zeros_like(selection)\nnp.put_along_axis(binary_result, np.expand_dims(game_result, axis=1), 1, axis=1)\n\npnl_1X2(selection, binary_result, odds)\n\narray([[-20. ],\n       [177.1],\n       [-80. ]])\n\n\n\n\nAsian handicap market\nThe PnL for the Asian handicap line is more complicated. It is related to the game goal-difference and the actual handicap line. It can result, as we described above, in 5 outcomes: win/half-win/fold/half-loss/loss.\n\\[ profit_{AH} = \\begin{cases}\n     0.0 & \\text{If Gd + line = 0} \\\\\\\\\n     \\frac{odds -1}{2}& \\text{If Gd + line = 0.25}\\\\\\\\\n     odds -1 & \\text{If Gd + line >= 0.5} \\\\\\\\\n     -0.5 & \\text{If Gd + line = -0.25} \\\\\\\\\n     -1.0 & \\text{If Gd + line <= -0.5} \\end{cases} \\]\nWith:\n\nGd : game goal difference\nline: Asian handicap line\nOdds : Asian handicap odds\n\n\nsource\n\n\npnl_ah\n\n pnl_ah (selection:numpy.ndarray, odds:numpy.ndarray,\n         obs_gd:numpy.ndarray, ah_line:numpy.ndarray)\n\nReturns the Asian Handicap PnL\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nselection\nndarray\nThe amount invested on each selection; shape n x 5; last 2 are for home/away asian handicap\n\n\nodds\nndarray\nmarket odds in 1|X|2|A1|A2 order; shape n x 5\n\n\nobs_gd\nndarray\nGame goal-difference; shape (n,)\n\n\nah_line\nndarray\nAsian line could be integer, half or quarter line; shape (n,)\n\n\nReturns\nndarray\nAsian Handicap PnL.\n\n\n\n\nselection = (\n    np.array([[0, 0, 0.0, 0.0, 0.5], [0, 0, 0, 0, 0], [0, 0, 0.0, 0.2, 0]]) * 100.0\n)\n\ninfo = fixture.head(3)\n\n# Game odds.\nodds = info[\n    [\n        \"preGameOdds1\",\n        \"preGameOddsX\",\n        \"preGameOdds2\",\n        \"preGameAhHome\",\n        \"preGameAhAway\",\n    ]\n].values\n\nobs_gd = info.tgt_gd.values\nah_line = info.LineId.values\n\n\npnl_ah(selection, odds, obs_gd, ah_line)\n\narray([[ 21.],\n       [  0.],\n       [-20.]])"
  },
  {
    "objectID": "Utils/pnl_calculator.html#pnl-wrapper",
    "href": "Utils/pnl_calculator.html#pnl-wrapper",
    "title": "1X2 and Asian Handicap Profit",
    "section": "Pnl wrapper",
    "text": "Pnl wrapper\nThis function computes the total PnL:\n\nsource\n\npnl\n\n pnl (selection:numpy.ndarray, odds:numpy.ndarray, obs_gd:numpy.ndarray,\n      ah_line:numpy.ndarray)\n\nReturns the total PnL\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\nselection\nndarray\nThe amount invested on each selection; shape n x 5; last 2 are for home/away asian handicap\n\n\nodds\nndarray\nmarket odds in 1|X|2|A1|A2 order; shape n x 5\n\n\nobs_gd\nndarray\nGame goal-difference; shape (n,)\n\n\nah_line\nndarray\nAsian line could be integer, half or quarter line; shape (n,)\n\n\nReturns\nndarray\nAsian Handicap PnL.\n\n\n\n\nselection = (\n    np.array(\n        [\n            [0, 0.0, 0, 0.0, 0.3],  # bet on asian 2\n            #[0.3, 0, 0, 0, 0],  # bet on home\n            #[0, 0, 0.6, 0.0, 0],  # bet on away\n            #[0, 0, 0.0, 0.6, 0],  # bet on asian 1\n            #[0, 0.5, 0.0, 0.0, 0],  # bet on X\n        ]\n    )\n    * 100.0\n)\n\ninfo = fixture.head(selection.shape[0])\n\n# Game odds.\nodds = info[\n    [\n        \"preGameOdds1\",\n        \"preGameOddsX\",\n        \"preGameOdds2\",\n        \"preGameAhHome\",\n        \"preGameAhAway\",\n    ]\n].values\n\nobs_gd = info.tgt_gd.values\nah_line = info.LineId.values\n\npnl(selection, odds, obs_gd, ah_line)\n\narray([[12.6]])"
  },
  {
    "objectID": "Utils/data_extractor.html",
    "href": "Utils/data_extractor.html",
    "title": "Data Extractor",
    "section": "",
    "text": "We provide a function that seeks to retrieve the list of games recorded in our gameFeatures MongoDb Collection and aggregate it with its additional features such as Lineups information (lineups Collection) and 1x2 and Asian Handicap odds(Odds collection).\n\nsource\n\n\n\n data_aggregator (db_hosts:dict, config:dict, db_host:str='prod_atlas',\n                  limit:int=None)\n\nReturns and aggregates games information from multiple Db collections.\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ndb_hosts\ndict\n\nAll DB hosts.\n\n\nconfig\ndict\n\nDatabase config.\n\n\ndb_host\nstr\nprod_atlas\nDatabase host name.\n\n\nlimit\nint\nNone\nNumber of rows to extract.\n\n\nReturns\nDataFrame\n\nMapped games.\n\n\n\n\nfrom betting_env.config.localconfig import CONFIG, DB_HOSTS\n\n\ndata_aggregator(\n    db_hosts=DB_HOSTS,\n    config=CONFIG,\n    db_host= \"public_atlas\",\n    limit=3,\n)\n\n\n\n\n\n  \n    \n      \n      gameId\n      game_optaId\n      gameDate\n      homeTeamId\n      homeTeam_optaId\n      awayTeamId\n      awayTeam_optaId\n      tgt_gd\n      tgt_outcome\n      preGameOdds1\n      ...\n      homeTeamLineupIds\n      homeTeamLineupSlots\n      homeTeamFormation\n      home_team_lineup_received_at\n      awayTeamName\n      awayTeamLineup\n      awayTeamLineupIds\n      awayTeamLineupSlots\n      awayTeamFormation\n      away_team_lineup_received_at\n    \n  \n  \n    \n      0\n      219ef70c0e8a803ec1efdb793443edfaa32398690c7829...\n      991003\n      2018-08-22 18:45:00\n      aeb2f56fcedbcf4cd5c780179766996c7bf0b308064541...\n      5\n      f8daf96ad35eebf1c0a5886c72734ba7dec366d6637052...\n      108\n      0\n      1.0\n      1.980\n      ...\n      [156685, 15398, 154561, 165183, 61602, 167802,...\n      [11, 9, 1, 3, 4, 5, 6, 2, 10, 8, 7]\n      4-2-3-1\n      2018-08-22 18:15:00\n      Reading\n      {\"Leandro Bacuna\": \"DMR\", \"Andy Yiadom\": \"DR\",...\n      [74297, 87408, 154133, 86857, 17506, 112133, 2...\n      [4, 2, 8, 6, 5, 3, 1, 7, 10, 11, 9]\n      4-4-2\n      2018-08-22 18:15:00\n    \n    \n      1\n      174dba7291174b4dbbfa9ea12dd944bb45bdd8ed905524...\n      990997\n      2018-08-22 18:45:00\n      126905d14981e6b97912ad4fec354035ccef26cb8ec4e1...\n      7\n      419088133137a53bfdb1b7e2e682d223d33a6fa075bbfe...\n      94\n      0\n      1.0\n      2.620\n      ...\n      [12150, 59115, 122806, 54764, 49773, 37339, 43...\n      [4, 6, 8, 9, 11, 7, 5, 2, 3, 1, 10]\n      4-4-1-1\n      2018-08-22 18:15:00\n      Brentford\n      {\"Daniel Bentley\": \"GK\", \"Ezri Konsa\": \"DCR\", ...\n      [79602, 199798, 115382, 114275, 176442, 223911...\n      [1, 5, 9, 8, 3, 6, 7, 10, 4, 11, 2]\n      4-2-3-1\n      2018-08-22 18:15:00\n    \n    \n      2\n      019c223b4a03917c2f1685beab4d5d278f7bff3913f239...\n      991018\n      2018-08-25 14:00:00\n      eb89c068ca204a72408360450847a990c97c5b5ff0ec9f...\n      110\n      bbb63e4ea54b0d60b48a1f8440254d7e656dfbfcbef825...\n      88\n      2\n      0.0\n      1.917\n      ...\n      [85352, 3773, 105666, 91972, 40555, 61858, 394...\n      [6, 9, 1, 10, 4, 7, 3, 11, 2, 5, 8]\n      4-4-1-1\n      2018-08-25 13:30:00\n      Hull City\n      {\"Eric Lichaj\": \"DR\", \"Jordy De Wijs\": \"DCL\", ...\n      [45139, 173549, 15144, 82771, 240499, 28541, 5...\n      [2, 6, 1, 4, 8, 9, 10, 3, 7, 11, 5]\n      4-4-1-1\n      2018-08-25 13:30:00\n    \n  \n\n3 rows × 27 columns"
  },
  {
    "objectID": "Environment/betting_env.html",
    "href": "Environment/betting_env.html",
    "title": "OpenAI Gym Env",
    "section": "",
    "text": "import plotly.io as pio\nUsing the config.toml credentials included in the main repository, we must first load games data stored in our MongoDb Cluster before testing our betting environment."
  },
  {
    "objectID": "Environment/betting_env.html#the-observation-class",
    "href": "Environment/betting_env.html#the-observation-class",
    "title": "OpenAI Gym Env",
    "section": "the Observation class",
    "text": "the Observation class\nWe provide here a simple class that stores our Environment observations.\n\nThe first format is a numpy array that encodes game information and that will be passed to the computation framework.\nThe second format is a user-friendly output that can displayed to the screen.\n\n\nsource\n\nObservation\n\n Observation (game_id:int, game_date:datetime.datetime,\n              lineups:numpy.ndarray, lineups_ids:numpy.ndarray,\n              lineups_slots:numpy.ndarray,\n              lineups_formation:numpy.ndarray, teams_names:numpy.ndarray,\n              ra_teams_ids:numpy.ndarray, opta_teams_ids:numpy.ndarray,\n              betting_market:numpy.ndarray, ah_line:float, shape:tuple)\n\nInitialize self. See help(type(self)) for accurate signature.\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\ngame_id\nint\nGame Id.\n\n\ngame_date\ndatetime\nGame Date\n\n\nlineups\nndarray\nLineups(playerName:position), shape=(2,).\n\n\nlineups_ids\nndarray\nLineups opta Ids [list(11 home players Ids),list(11 away players Ids)], shape=(2,).\n\n\nlineups_slots\nndarray\nLineups slots [list(11 home positions Ids),list(11 away positions Ids)], shape=(2,).\n\n\nlineups_formation\nndarray\nLineups formations [home team formation, away team formation], shape=(2,).\n\n\nteams_names\nndarray\nTeam names (homeTeam name, awayteam name), shape=(2,).\n\n\nra_teams_ids\nndarray\nTeams Real-Analytics Ids [homeTeam Id, awayTeam Id], shape=(2,).\n\n\nopta_teams_ids\nndarray\nTeams opta Ids [homeTeam Id, awayTeam Id], shape=(2,).\n\n\nbetting_market\nndarray\nOdds [[1X2 and Asian Handicap]], shape=(1,5).\n\n\nah_line\nfloat\nAsian handicap line.\n\n\nshape\ntuple\nObservation shape = (30,).\n\n\n\nNext, we patch some useful methods to mimic the behaviour of a numpy array:\n\nsource\n\n\nObservation.astype\n\n Observation.astype (data_type:str)\n\nCast observation type.\n\n\n\n\nType\nDetails\n\n\n\n\ndata_type\nstr\nnew type to convert to\n\n\nReturns\nObservation\n\n\n\n\n\nsource\n\n\nObservation.reshape\n\n Observation.reshape (new_shape:tuple)\n\nReshape observation.\n\n\n\n\nType\nDetails\n\n\n\n\nnew_shape\ntuple\nnew shape to transform the object in\n\n\nReturns\nObservation\n\n\n\n\nFinally, we provide a use friendly formatting method:\n\nsource\n\n\nObservation.pretty\n\n Observation.pretty ()\n\nUser-friendly output\n\n# Get 1 example from the extracted data.\nfixture = fixtures.head(1)\n\n# Init an Observation.\nobservation = Observation(\n    game_id=fixture.game_optaId.values[0],  # Game Id.\n    game_date=fixture.gameDate.values[0],  # Game date.\n    lineups=fixture[[\"homeTeamLineup\", \"awayTeamLineup\"]].values[\n        0\n    ],  # Lineup (playerName:position).\n    lineups_ids=fixture[[\"homeTeamLineupIds\", \"awayTeamLineupIds\"]].values[\n        0\n    ],  # Lineups opta Ids [list(11 home players Ids),list(11 away players Ids)].\n    lineups_slots=fixture[[\"homeTeamLineupSlots\", \"awayTeamLineupSlots\"]].values[\n        0\n    ],  # Lineups slots [list(11 home positions Ids),list(11 away positions Ids)].\n    lineups_formation=fixture[[\"homeTeamFormation\", \"awayTeamFormation\"]].values[\n        0\n    ],  # Lineups formations [home team formation, away team formation].\n    teams_names=fixture[[\"homeTeamName\", \"awayTeamName\"]].values[\n        0\n    ],  # Team names (homeTeam name, awayteam name).\n    ra_teams_ids=fixture[[\"homeTeamId\", \"awayTeamId\"]].values[0],\n    opta_teams_ids=fixture[[\"homeTeam_optaId\", \"awayTeam_optaId\"]].values[\n        0\n    ],  # Teams opta Ids [homeTeam Id, awayTeam Id].\n    betting_market=fixture[\n        [\n            \"preGameOdds1\",\n            \"preGameOdds2\",\n            \"preGameOddsX\",\n            \"preGameAhHome\",\n            \"preGameAhAway\",\n        ]\n    ].values,  # Odds [[1X2 and Asian Handicap]].\n    ah_line=fixture.LineId.values[0],  # Asian handicap line.\n    shape=(30,),  # Observation shape.\n)\n\n\npretty_output = observation().pretty()\npretty_output\n\n\n\n\n\n  \n    \n      \n      gameId\n      gameDate\n      homeTeam\n      awayTeam\n      homeLineup\n      awayLineup\n      homeFormation\n      awayFormation\n      odds1\n      oddsX\n      odds2\n      oddsAhHome\n      oddsAhAway\n      ahLine\n    \n  \n  \n    \n      0\n      990997\n      2018-08-22 18:45:00\n      Aston Villa\n      Brentford\n      {\"Glenn Whelan\": \"DMR\", \"Mile Jedinak\": \"DCL\",...\n      {\"Daniel Bentley\": \"GK\", \"Ezri Konsa\": \"DCR\", ...\n      4-4-1-1\n      4-2-3-1\n      2.62\n      2.77\n      3.53\n      1.49\n      2.75\n      0.5"
  },
  {
    "objectID": "Environment/betting_env.html#betting-environment",
    "href": "Environment/betting_env.html#betting-environment",
    "title": "OpenAI Gym Env",
    "section": "Betting Environment",
    "text": "Betting Environment\n\nBetting assumptions\nReinforcement Learning is a branch of machine learning (ML) that focuses on the complex and all-encompassing issue of training a system to behave appropriately in a given situation. Only the value of the reward and observations made about the environment are used to drive learning. The generality of this model allows it to be used in a wide range of real-world contexts, from gaming to the improvement of sophisticated industrial procedures.\nIn this perspective, the environment and the agent are two crucial elements of the Reinforcement Learning (RL) problem. The environment is the Agent’s world where it exists and the Agent can engage in interactions with this environment by taking certain actions which cannot change the environment’s laws or dynamics.\nThe goal of this work is to develop an RL environment that simulates a betting strategy. The theory underlying this environment is quite straightforward:\n\nselect a market and a selection (side) based on the available odds.\ndecide how much to invest (stake-size).\ncompute a profit and loss (PnL) based on the game outcome.\n\nThe real word situation can be quite complex with multiple markets available and different betting options. To keep things simple, the agent is only allowed to: - place a small, medium, or a large bet. - select at most one betting opportunity out of home, draw, or away for the 1x2 market, and home or away on the even Asian handicap line. - the agent is only allowed to pick one size of bets and a unique selection to bet on (out of the 5 options available). - games are presented to the agent as soon as the official lineup becomes available.\n\n\ngym environment\nBased on the betting assumptions discussed above, we will implement a custom OpenAI Gym environment. + an observation is an instance of the Observation class with the following information: - game-identifier - home and away team lineup - available odds for the 1x2 and the even money Asian handicap markets. + the action space is discrete with size 15 which corresponds to one bet size (1 out of 3) in one of the available selection (1 out of 5). + the reward (the investment return), which can be positive or negative, is then calculated and the agent bank updated. + an episode terminates if i) no more games are available to bet on ii) the agent goes bankrupt.\n\nInitialize\nThe environment is initialized by extending the gym.Env base class:\n\nsource\n\n\n\nBettingEnv\n\n BettingEnv (game_info:pandas.core.frame.DataFrame,\n             odds_column_names:list=['preGameOdds1', 'preGameOdds2',\n             'preGameOddsX', 'preGameAhHome', 'preGameAhAway'],\n             starting_bank:float=100.0, small_bet:float=0.05,\n             medium_bet:float=0.2, large_bet:float=0.7)\n\nOpenAI Gym class for football betting environments.\n\n\n\n\n\n\n\n\n\n\nType\nDefault\nDetails\n\n\n\n\ngame_info\nDataFrame\n\nGames with betting odds and other info.\n\n\nodds_column_names\nlist\n[‘preGameOdds1’, ‘preGameOdds2’, ‘preGameOddsX’, ‘preGameAhHome’, ‘preGameAhAway’]\n\n\n\nstarting_bank\nfloat\n100.0\nStarting bank account.\n\n\nsmall_bet\nfloat\n0.05\nSmall bet proportion value.\n\n\nmedium_bet\nfloat\n0.2\nMedium bet proportion value.\n\n\nlarge_bet\nfloat\n0.7\nLarge bet proportion value.\n\n\nReturns\nNone\n\n\n\n\n\n\nGet an observation\n\nsource\n\n\n\nBettingEnv.get_observation\n\n BettingEnv.get_observation ()\n\nReturns the observation of the current step.\n\nreset the environment\n\nsource\n\n\n\nBettingEnv.reset\n\n BettingEnv.reset ()\n\nResets the state of the environment and returns an initial observation.\n\nThe step method\nA step in the environment executes the following: + Initialize the info collector + Check the balance to decide whether the betting should continue or not + If some money is available, the bet is executed (even if the money is shorter than the required amount) and the results computed. + The bet outcome (reward) is then computed and the agent’s balance and bank are updated. + Finally, we check if the episode is done by consulting if there are games left in the buffer.\n\nsource\n\n\n\nBettingEnv.step\n\n BettingEnv.step (action:int)\n\nRun one timestep of the environment’s dynamics. It accepts an action and returns a tuple (observation, reward, done, info)\n\n\n\n\n\n\n\n\n\nType\nDetails\n\n\n\n\naction\nint\nThe chosen action by the agent.\n\n\nReturns\ntyping.Tuple[main.Observation, float, bool, typing.Dict]\nReturns (observation, reward, done, info).\n\n\n\n\nsource\n\n\nBettingEnv.render\n\n BettingEnv.render ()\n\nUpdates the figure with the current step data."
  }
]